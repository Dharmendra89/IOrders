<?xml version="1.0" encoding="utf-8"?>
<metadata xmlns="http://unact.net/xml/xi" name="iorders" version="1.32" expect-megabytes="15">
  <tables set-of="table">
    <table id="Warehouse" name="Склад" nameSet="Склады">
      <columns set-of="column">
        <column id="Warehouseid" name="id" type="int"/>
        <column id="Warehousename" name="name" type="string" label="Название"/>
      </columns>
      <deps set-of="dep">
        <dep table_id="Customer" id="Customerwarehouse"/>
        <dep table_id="Stock" id="Stockwarehouse"/>
      </deps>
    </table>
    <table id="Stock" name="Остаток" nameSet="Остатки">
      <columns set-of="column">
        <column id="Stockwarehouse" name="warehouse" type="int" parent="Warehouse" label="Склад" key="true"/>
        <column id="Stockproduct" name="product" parent="Product" label="Товар" key="true"/>
        <column id="StockstockLevel" name="stockLevel" type="int" label="Уровень запаса"/>
      </columns>
    </table>
    <table id="PricelistSet" name="Ценовая категория" nameSet="Ценовые категории">
      <columns set-of="column">
        <column id="PricelistSetid" name="id" type="int" key="true"/>
        <column id="PricelistSetname" name="name" type="string" label="Название"/>
      </columns>
      <deps set-of="dep">
        <dep table_id="PartnerPriceList" id="PartnerPriceListpricelistSet"/>
        <dep table_id="Price" id="PricepricelistSet"/>
      </deps>
    </table>
    <table id="Pricelist" name="Прайс-лист" nameSet="Прайс-листы">
      <columns set-of="column">
        <column id="Pricelistid" name="id" type="int" key="true"/>
        <column id="Pricelistname" name="name" type="string" label="Название"/>
      </columns>
      <deps set-of="dep">
        <dep table_id="PartnerPriceList" id="PartnerPriceListpricelist"/>
        <dep table_id="Price" id="Pricepricelist"/>
      </deps>
    </table>
    <table id="Category" name="Категория товаров" nameSet="Категории товаров">
      <columns set-of="column">
        <column id="Categoryid" name="id" type="int" key="true"/>
        <column id="Categoryname" name="name" type="string" label="Название"/>
        <column id="Categoryord" name="ord" type="int"/>
      </columns>
      <deps set-of="dep">
        <dep table_id="Price" id="Pricecategory"/>
        <dep table_id="Product" id="Productcategory"/>
      </deps>
    </table>
    <table id="Product" name="Товар" nameSet="Товары">
      <columns set-of="column">
        <column id="Productcategory" name="category" type="int" parent="Category" label="Категория товаров"/>
        <column id="Productid" name="id" type="int" key="true"/>
        <column id="Productname" name="name" type="string" label="Наименование"/>
        <column id="ProductfirstName" name="firstName" type="string" label="Преднаименование"/>
        <column id="Productfactor" name="factor" type="int" label="Кратность"/>
        <column id="Productrel" name="rel" type="int" label="Шт. в упаковке"/>
      </columns>
      <deps set-of="dep">
        <dep table_id="Price" id="Priceproduct"/>
        <dep table_id="Stock" id="Stockproduct"/>
      </deps>
    </table>
    <table id="Price" name="Цена прайс-листа" nameSet="Цены прайс-листа">
      <columns set-of="column">
        <column id="Pricecategory" name="category" type="int" parent="Category" label="Категория товаров" key="true"/>
        <column id="PricepricelistSet" name="pricelistSet" parent="PricelistSet" label="Ценовая категория" key="true"/>
        <column id="Pricepricelist" name="pricelist" parent="Pricelist" label="Прайс-лист" key="true"/>
        <column id="Priceproduct" name="product" parent="Product" label="Товар" key="true"/>
        <column id="Priceprice" name="price" type="float" label="Цена"/>
      </columns>
    </table>
    <table id="Partner" name="Партнер" nameSet="Партнеры">
      <columns set-of="column">
        <column id="Partnerid" name="id" type="int" key="true"/>
        <column id="Partnername" name="name" type="string" label="Название"/>
        <column id="Partnerplong" name="plong" type="int" label="Отсрочка оплаты"/>
      </columns>
      <deps set-of="dep">
        <dep table_id="PartnerPriceList" id="PartnerPriceListpartner"/>
        <dep table_id="Customer" id="Customerpartner"/>
        <dep table_id="Debt" id="Debtpartner"/>
      </deps>
    </table>
    <table id="PartnerPriceList" name="Прайслист партнера" nameSet="Прайслисты партнера">
      <columns set-of="column">
        <column id="PartnerPriceListpartner" name="partner" type="int" parent="Partner" label="Партнер" key="true"/>
        <column id="PartnerPriceListpricelistSet" name="pricelistSet" parent="PricelistSet" label="Ценовая категория" key="true"/>
        <column id="PartnerPriceListpricelist" name="pricelist" parent="Pricelist" label="Прайс-лист"/>
        <column id="PartnerPriceListdiscount" name="discount" type="float" label="% скидки"/>
      </columns>
    </table>
    <table id="Debt" name="Задолженность" nameSet="Задолженность">
      <columns set-of="column">
        <column id="Debtid" name="id" type="int" key="true"/>
        <column id="Debtddate" name="ddate" type="date" label="Дата"/>
        <column id="Debtndoc" name="ndoc" type="string" label="Документ№"/>
        <column id="DebtfullSumm" name="fullSumm" type="float" label="Сумма"/>
        <column id="DebtisWhite" name="isWhite" type="boolean" label="Нужен чек"/>
        <column id="DebtremSumm" name="remSumm" type="float" label="Задолженность"/>
        <column id="Debtpartner" name="partner" parent="Partner" label="Партнер"/>
      </columns>
    </table>
    <table id="Customer" name="Клиент" nameSet="Клиенты">
      <columns set-of="column">
        <column id="Customerpartner" name="partner" type="int" parent="Partner" label="Партнер"/>
        <column id="Customerid" name="id" type="int" key="true"/>
        <column id="Customername" name="name" type="string" label="Название"/>
        <column id="Customeraddress" name="address" type="string" label="Адрес"/>
        <column id="Customerwarehouse" name="warehouse" parent="Warehouse" label="Склад"/>
      </columns>
      <deps set-of="dep">
        <dep table_id="SaleOrder" id="SaleOrdercustomer"/>
      </deps>
    </table>
    <table id="SaleOrder" name="Заказ" nameSet="Заказы" extendable="true" editable="true">
      <columns set-of="column">
        <column id="SaleOrdercustomer" name="customer" type="int" parent="Customer" label="Клиент"/>
        <column id="SaleOrderid" name="id" type="string" key="true"/>
        <column id="SaleOrderxid" name="xid"/>
        <column id="SaleOrderincassNeeded" name="incassNeeded" type="boolean" label="Требуется инкассация" editable="true"/>
        <column id="SaleOrderisWhite" name="isWhite" type="boolean" label="Нужен счет-фактура" editable="true"/>
        <column id="SaleOrderdate" name="date" type="date" label="Дата доставки" editable="true"/>
        <column id="SaleOrdertotalCost" name="totalCost" type="float" label="Стоимость" editable="true"/>
      </columns>
      <deps set-of="dep">
        <dep table_id="SaleOrderPosition" id="SaleOrderPositionsaleorder" contains="true"/>
      </deps>
    </table>
    <table id="SaleOrderPosition" name="Позиция заказа" nameSet="Позиции заказа" extendable="true" editable="new-only" belongs="SaleOrder">
      <columns set-of="column">
        <column id="SaleOrderPositionsaleorder" name="saleorder" type="string" parent="SaleOrder" label="Заказ" key="true"/>
        <column id="SaleOrderPositionvolume" name="volume" type="int" label="Кол-во" editable="true"/>
        <column id="SaleOrderPositioncost" name="cost" type="float" label="Стоимость" editable="true"/>
        <column id="SaleOrderPositionxid" name="xid"/>
        <column id="SaleOrderPositionproduct" name="product" parent="Product" label="Товар" editable="new-only" key="true"/>
      </columns>
    </table>
  </tables>
  <views set-of="view">
    <view id="Offer">
      <columns set-of="column">
        <column id="Offercustomer" name="customer" label="Клиент"/>
        <column id="Offercategory" name="category" label="Категория товаров"/>
        <column id="Offerprice" name="price" type="float" label="Цена"/>
        <column id="Offerproduct" name="product" label="Товар"/>
        <column id="OfferfirstName" name="firstName" type="string" label="Преднаименование"/>
        <column id="Offername" name="name" type="string" label="Наименование"/>
        <column id="Offerrel" name="rel" type="int" label="Шт. в упаковке"/>
        <column id="Offerfactor" name="factor" type="int" label="Кратность"/>
        <column id="OfferstockLevel" name="stockLevel" type="int" label="Уровень запаса"/>
        <column id="Offercost" name="cost" type="float" label="Стоимость"/>
      </columns>
      <sql>select c.id as customer, g.category, p.price, g.id as Product, g.firstName, g.name, g.rel, g.factor, s.stockLevel, 0 as isActive, null as cost from Customer c join PartnerPriceList ppl on ppl.partner = c.partner join Price p on p.pricelistSet = ppl.pricelistSet and p.priceList = ppl.priceList join Product g on g.id = p.product join Stock s on s.product = g.id and s.warehouse = c.warehouse and s.stockLevel &gt; 0</sql>
    </view>
    <view id="OfferCategory">
      <columns set-of="column">
        <column id="OfferCategorycustomer" name="customer" label="Клиент"/>
        <column id="OfferCategorycategory" name="category" label="Категория товаров"/>
        <column id="OfferCategoryname" name="name" type="string" label="Название"/>
        <column id="OfferCategorytotalCost" name="totalCost" type="float" label="Стоимость"/>
      </columns>
      <sql>select * from ( select cu.id as customer, c.id category, c.name, null as totalCost from Customer cu, Category c where exists (select * from Offer where c.id=category and customer = cu.id) )</sql>
    </view>
  </views>
</metadata>
